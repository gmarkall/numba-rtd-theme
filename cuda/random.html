

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.7. Random Number Generation &mdash; Numba 0.49.0dev0+637.g3a659b257 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/numba-blue-icon-rgb.svg"/>
  
  
  
    <link rel="canonical" href="http://numba.pydata.org/numba-doc/latest/index.htmlcuda/random.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.8. Device management" href="device-management.html" />
    <link rel="prev" title="3.6. Supported Atomic Operations" href="intrinsics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #00A3E0" >
          

          
            <a href="../index.html" class="icon icon-home"> Numba
          

          
            
            <img src="../_static/numba-white-icon-rgb.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.49
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">1. User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">2. Reference Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">3. Numba for CUDA GPUs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">3.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernels.html">3.2. Writing CUDA Kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html">3.3. Memory management</a></li>
<li class="toctree-l2"><a class="reference internal" href="device-functions.html">3.4. Writing Device Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cudapysupported.html">3.5. Supported Python features in CUDA Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="intrinsics.html">3.6. Supported Atomic Operations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.7. Random Number Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">3.7.1. Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="device-management.html">3.8. Device management</a></li>
<li class="toctree-l2"><a class="reference internal" href="device-management.html#the-device-list">3.9. The Device List</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">3.10. Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulator.html">3.11. Debugging CUDA Python with the the CUDA Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="reduction.html">3.12. GPU Reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="ufunc.html">3.13. CUDA Ufuncs and Generalized Ufuncs</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipc.html">3.14. Sharing CUDA Memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="cuda_array_interface.html">3.15. CUDA Array Interface (Version 2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">3.16. CUDA Frequently Asked Questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cuda-reference/index.html">4. CUDA Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roc/index.html">5. Numba for AMD ROC GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">6. Extending Numba</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">7. Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proposals/index.html">8. Numba Enhancement Proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">10. Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Numba</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">3. Numba for CUDA GPUs</a> &raquo;</li>
        
      <li>3.7. Random Number Generation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/cuda/random.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="random-number-generation">
<span id="cuda-random"></span><h1>3.7. Random Number Generation<a class="headerlink" href="#random-number-generation" title="Permalink to this headline">¶</a></h1>
<p>Numba provides a random number generation algorithm that can be executed on
the GPU.  Due to technical issues with how NVIDIA implemented cuRAND, however,
Numba’s GPU random number generator is not based on cuRAND.  Instead, Numba’s
GPU RNG is an implementation of the <a class="reference external" href="http://xoroshiro.di.unimi.it/">xoroshiro128+ algorithm</a>. The xoroshiro128+ algorithm has a period of
<code class="docutils literal notranslate"><span class="pre">2**128</span> <span class="pre">-</span> <span class="pre">1</span></code>, which is shorter than the period of the XORWOW algorithm
used by default in cuRAND, but xoroshiro128+ still passes the BigCrush tests
of random number generator quality.</p>
<p>When using any RNG on the GPU, it is important to make sure that each thread
has its own RNG state, and they have been initialized to produce non-overlapping
sequences.  The  numba.cuda.random module provides a host function to do this,
as well as CUDA device functions to obtain uniformly or normally distributed
random numbers.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Numba (like cuRAND) uses the
<cite>Box-Muller transform &lt;https://en.wikipedia.org/wiki/Box%E2%80%93Muller_transform&gt;</cite>
to generate normally distributed random numbers from a uniform generator.
However, Box-Muller generates pairs of random numbers, and the current
implementation only returns one of them.  As a result, generating normally
distributed values is half the speed of uniformly distributed values.</p>
</div>
<dl class="function">
<dt>
<code class="sig-prename descclassname">numba.cuda.random.</code><code class="sig-name descname">create_xoroshiro128p_states</code><span class="sig-paren">(</span><em class="sig-param">n</em>, <em class="sig-param">seed</em>, <em class="sig-param">subsequence_start=0</em>, <em class="sig-param">stream=0</em><span class="sig-paren">)</span></dt>
<dd><p>Returns a new device array initialized for n random number generators.</p>
<p>This initializes the RNG states so that each state in the array corresponds
subsequences in the separated by 2**64 steps from each other in the main
sequence.  Therefore, as long no CUDA thread requests more than 2**64
random numbers, all of the RNG states produced by this function are
guaranteed to be independent.</p>
<p>The subsequence_start parameter can be used to advance the first RNG state
by a multiple of 2**64 steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – number of RNG states to create</p></li>
<li><p><strong>seed</strong> (<em>uint64</em>) – starting seed for list of generators</p></li>
<li><p><strong>subsequence_start</strong> (<em>uint64</em>) – </p></li>
<li><p><strong>stream</strong> (<em>CUDA stream</em>) – stream to run initialization kernel on</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt>
<code class="sig-prename descclassname">numba.cuda.random.</code><code class="sig-name descname">init_xoroshiro128p_states</code><span class="sig-paren">(</span><em class="sig-param">states</em>, <em class="sig-param">seed</em>, <em class="sig-param">subsequence_start=0</em>, <em class="sig-param">stream=0</em><span class="sig-paren">)</span></dt>
<dd><p>Initialize RNG states on the GPU for parallel generators.</p>
<p>This initializes the RNG states so that each state in the array corresponds
subsequences in the separated by 2**64 steps from each other in the main
sequence.  Therefore, as long no CUDA thread requests more than 2**64
random numbers, all of the RNG states produced by this function are
guaranteed to be independent.</p>
<p>The subsequence_start parameter can be used to advance the first RNG state
by a multiple of 2**64 steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>states</strong> (<em>1D DeviceNDArray</em><em>, </em><em>dtype=xoroshiro128p_dtype</em>) – array of RNG states</p></li>
<li><p><strong>seed</strong> (<em>uint64</em>) – starting seed for list of generators</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-prename descclassname">numba.cuda.random.</code><code class="sig-name descname">xoroshiro128p_uniform_float32</code><span class="sig-paren">(</span><em class="sig-param">states</em>, <em class="sig-param">index</em><span class="sig-paren">)</span></dt>
<dd><p>Return a float32 in range [0.0, 1.0) and advance <code class="docutils literal notranslate"><span class="pre">states[index]</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>states</strong> (<em>1D array</em><em>, </em><em>dtype=xoroshiro128p_dtype</em>) – array of RNG states</p></li>
<li><p><strong>index</strong> (<em>int64</em>) – offset in states to update</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>float32</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-prename descclassname">numba.cuda.random.</code><code class="sig-name descname">xoroshiro128p_uniform_float64</code><span class="sig-paren">(</span><em class="sig-param">states</em>, <em class="sig-param">index</em><span class="sig-paren">)</span></dt>
<dd><p>Return a float64 in range [0.0, 1.0) and advance <code class="docutils literal notranslate"><span class="pre">states[index]</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>states</strong> (<em>1D array</em><em>, </em><em>dtype=xoroshiro128p_dtype</em>) – array of RNG states</p></li>
<li><p><strong>index</strong> (<em>int64</em>) – offset in states to update</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>float64</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-prename descclassname">numba.cuda.random.</code><code class="sig-name descname">xoroshiro128p_normal_float32</code><span class="sig-paren">(</span><em class="sig-param">states</em>, <em class="sig-param">index</em><span class="sig-paren">)</span></dt>
<dd><p>Return a normally distributed float32 and advance <code class="docutils literal notranslate"><span class="pre">states[index]</span></code>.</p>
<p>The return value is drawn from a Gaussian of mean=0 and sigma=1 using the
Box-Muller transform.  This advances the RNG sequence by two steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>states</strong> (<em>1D array</em><em>, </em><em>dtype=xoroshiro128p_dtype</em>) – array of RNG states</p></li>
<li><p><strong>index</strong> (<em>int64</em>) – offset in states to update</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>float32</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-prename descclassname">numba.cuda.random.</code><code class="sig-name descname">xoroshiro128p_normal_float64</code><span class="sig-paren">(</span><em class="sig-param">states</em>, <em class="sig-param">index</em><span class="sig-paren">)</span></dt>
<dd><p>Return a normally distributed float32 and advance <code class="docutils literal notranslate"><span class="pre">states[index]</span></code>.</p>
<p>The return value is drawn from a Gaussian of mean=0 and sigma=1 using the
Box-Muller transform.  This advances the RNG sequence by two steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>states</strong> (<em>1D array</em><em>, </em><em>dtype=xoroshiro128p_dtype</em>) – array of RNG states</p></li>
<li><p><strong>index</strong> (<em>int64</em>) – offset in states to update</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>float64</p>
</dd>
</dl>
</dd></dl>

<div class="section" id="example">
<h2>3.7.1. Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Here is a sample program that uses the random number generator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span>

<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">cuda</span>
<span class="kn">from</span> <span class="nn">numba.cuda.random</span> <span class="kn">import</span> <span class="n">create_xoroshiro128p_states</span><span class="p">,</span> <span class="n">xoroshiro128p_uniform_float32</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nd">@cuda</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">compute_pi</span><span class="p">(</span><span class="n">rng_states</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find the maximum value in values and store in result[0]&quot;&quot;&quot;</span>
    <span class="n">thread_id</span> <span class="o">=</span> <span class="n">cuda</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Compute pi by drawing random (x, y) points and finding what</span>
    <span class="c1"># fraction lie inside a unit circle</span>
    <span class="n">inside</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">xoroshiro128p_uniform_float32</span><span class="p">(</span><span class="n">rng_states</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">xoroshiro128p_uniform_float32</span><span class="p">(</span><span class="n">rng_states</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">inside</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">out</span><span class="p">[</span><span class="n">thread_id</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">inside</span> <span class="o">/</span> <span class="n">iterations</span>

<span class="n">threads_per_block</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">rng_states</span> <span class="o">=</span> <span class="n">create_xoroshiro128p_states</span><span class="p">(</span><span class="n">threads_per_block</span> <span class="o">*</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">threads_per_block</span> <span class="o">*</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">compute_pi</span><span class="p">[</span><span class="n">blocks</span><span class="p">,</span> <span class="n">threads_per_block</span><span class="p">](</span><span class="n">rng_states</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pi:&#39;</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="device-management.html" class="btn btn-neutral float-right" title="3.8. Device management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="intrinsics.html" class="btn btn-neutral float-left" title="3.6. Supported Atomic Operations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2020, Anaconda, Inc. and others

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>