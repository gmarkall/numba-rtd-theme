

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.9. Floating-point pitfalls &mdash; Numba 0.49.0dev0+637.g3a659b257 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/numba-blue-icon-rgb.svg"/>
  
  
  
    <link rel="canonical" href="http://numba.pydata.org/numba-doc/latest/index.htmlreference/fpsemantics.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.10. Python 2.7 End of Life Plan" href="python27-eol.html" />
    <link rel="prev" title="2.8. Deviations from Python Semantics" href="pysemantics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #00A3E0" >
          

          
            <a href="../index.html" class="icon icon-home"> Numba
          

          
            
            <img src="../_static/numba-white-icon-rgb.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.49
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">1. User Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. Reference Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="types.html">2.1. Types and signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="jit-compilation.html">2.2. Just-in-Time compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="aot-compilation.html">2.3. Ahead-of-Time compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">2.4. Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="envvars.html">2.5. Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysupported.html">2.6. Supported Python features</a></li>
<li class="toctree-l2"><a class="reference internal" href="numpysupported.html">2.7. Supported NumPy features</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysemantics.html">2.8. Deviations from Python Semantics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.9. Floating-point pitfalls</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#precision-and-accuracy">2.9.1. Precision and accuracy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#math-library-implementations">2.9.1.1. Math library implementations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linear-algebra">2.9.1.2. Linear algebra</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mixed-types-operations">2.9.1.3. Mixed-types operations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#warnings-and-errors">2.9.2. Warnings and errors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python27-eol.html">2.10. Python 2.7 End of Life Plan</a></li>
<li class="toctree-l2"><a class="reference internal" href="deprecation.html">2.11. Deprecation Notices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/index.html">3. Numba for CUDA GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda-reference/index.html">4. CUDA Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roc/index.html">5. Numba for AMD ROC GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">6. Extending Numba</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">7. Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proposals/index.html">8. Numba Enhancement Proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">10. Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Numba</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">2. Reference Manual</a> &raquo;</li>
        
      <li>2.9. Floating-point pitfalls</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/reference/fpsemantics.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="floating-point-pitfalls">
<h1>2.9. Floating-point pitfalls<a class="headerlink" href="#floating-point-pitfalls" title="Permalink to this headline">¶</a></h1>
<div class="section" id="precision-and-accuracy">
<h2>2.9.1. Precision and accuracy<a class="headerlink" href="#precision-and-accuracy" title="Permalink to this headline">¶</a></h2>
<p>For some operations, Numba may use a different algorithm than Python or
Numpy.  The results may not be bit-by-bit compatible.  The difference
should generally be small and within reasonable expectations.  However,
small accumulated differences might produce large differences at the end,
especially if a divergent function is involved.</p>
<div class="section" id="math-library-implementations">
<h3>2.9.1.1. Math library implementations<a class="headerlink" href="#math-library-implementations" title="Permalink to this headline">¶</a></h3>
<p>Numba supports a variety of platforms and operating systems, each of which
has its own math library implementation (referred to as <code class="docutils literal notranslate"><span class="pre">libm</span></code> from here
in).  The majority of math functions included in <code class="docutils literal notranslate"><span class="pre">libm</span></code> have specific
requirements as set out by the IEEE 754 standard (like <code class="docutils literal notranslate"><span class="pre">sin()</span></code>, <code class="docutils literal notranslate"><span class="pre">exp()</span></code>
etc.), but each implementation may have bugs.  Thus, on some platforms
Numba has to exercise special care in order to workaround known <code class="docutils literal notranslate"><span class="pre">libm</span></code>
issues.</p>
<p>Another typical problem is when an operating system’s <code class="docutils literal notranslate"><span class="pre">libm</span></code> function
set is incomplete and needs to be supplemented by additional functions.
These are provided with reference to the IEEE 754 and C99 standards
and are often implemented in Numba in a manner similar to equivalent
CPython functions.</p>
</div>
<div class="section" id="linear-algebra">
<h3>2.9.1.2. Linear algebra<a class="headerlink" href="#linear-algebra" title="Permalink to this headline">¶</a></h3>
<p>Numpy forces some linear algebra operations to run in double-precision mode
even when a <code class="docutils literal notranslate"><span class="pre">float32</span></code> input is given.  Numba will always observe
the input’s precision, and invoke single-precision linear algebra routines
when all inputs are <code class="docutils literal notranslate"><span class="pre">float32</span></code> or <code class="docutils literal notranslate"><span class="pre">complex64</span></code>.</p>
<p>The implementations of the <code class="docutils literal notranslate"><span class="pre">numpy.linalg</span></code> routines in Numba only support the
floating point types that are used in the LAPACK functions that provide
the underlying core functionality. As a result  only <code class="docutils literal notranslate"><span class="pre">float32</span></code>, <code class="docutils literal notranslate"><span class="pre">float64</span></code>,
<code class="docutils literal notranslate"><span class="pre">complex64</span></code> and <code class="docutils literal notranslate"><span class="pre">complex128</span></code> types are supported. If a user has e.g. an
<code class="docutils literal notranslate"><span class="pre">int32</span></code> type, an appropriate type conversion must be performed to a
floating point type prior to its use in these routines. The reason for this
decision is to essentially avoid having to replicate type conversion choices
made in Numpy and to also encourage the user to choose the optimal floating
point type for the operation they are undertaking.</p>
</div>
<div class="section" id="mixed-types-operations">
<h3>2.9.1.3. Mixed-types operations<a class="headerlink" href="#mixed-types-operations" title="Permalink to this headline">¶</a></h3>
<p>Numpy will most often return a <code class="docutils literal notranslate"><span class="pre">float64</span></code> as a result of a computation
with mixed integer and floating-point operands (a typical example is the
power operator <code class="docutils literal notranslate"><span class="pre">**</span></code>).  Numba by contrast will select the highest precision
amongst the floating-point operands, so for example <code class="docutils literal notranslate"><span class="pre">float32</span> <span class="pre">**</span> <span class="pre">int32</span></code>
will return a <code class="docutils literal notranslate"><span class="pre">float32</span></code>, regardless of the input values.  This makes
performance characteristics easier to predict, but you should explicitly
cast the input to <code class="docutils literal notranslate"><span class="pre">float64</span></code> if you need the extra precision.</p>
</div>
</div>
<div class="section" id="warnings-and-errors">
<span id="ufunc-fpu-errors"></span><h2>2.9.2. Warnings and errors<a class="headerlink" href="#warnings-and-errors" title="Permalink to this headline">¶</a></h2>
<p>When calling a <a class="reference internal" href="../glossary.html#term-ufunc"><span class="xref std std-term">ufunc</span></a> created with <a class="reference internal" href="jit-compilation.html#numba.vectorize" title="numba.vectorize"><code class="xref py py-func docutils literal notranslate"><span class="pre">vectorize()</span></code></a>,
Numpy will determine whether an error occurred by examining the FPU
error word.  It may then print out a warning or raise an exception
(such as <code class="docutils literal notranslate"><span class="pre">RuntimeWarning:</span> <span class="pre">divide</span> <span class="pre">by</span> <span class="pre">zero</span> <span class="pre">encountered</span></code>),
depending on the current error handling settings.</p>
<p>Depending on how LLVM optimized the ufunc’s code, however, some spurious
warnings or errors may appear.  If you get caught by this issue, we
recommend you call <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.seterr.html#numpy.seterr" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.seterr()</span></code></a> to change Numpy’s error handling
settings, or the <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.errstate.html#numpy.errstate" title="(in NumPy v1.17)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.errstate</span></code></a> context manager to switch them
temporarily:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">my_ufunc</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="python27-eol.html" class="btn btn-neutral float-right" title="2.10. Python 2.7 End of Life Plan" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pysemantics.html" class="btn btn-neutral float-left" title="2.8. Deviations from Python Semantics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2020, Anaconda, Inc. and others

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>