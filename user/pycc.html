

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.9. Compiling code ahead of time &mdash; Numba 0.49.0dev0+636.ga4807f5d8 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/numba-blue-icon-rgb.svg"/>
  
  
  
    <link rel="canonical" href="http://numba.pydata.org/numba-doc/latest/index.htmluser/pycc.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1.10. Automatic parallelization with @jit" href="parallel.html" />
    <link rel="prev" title="1.8. Creating C callbacks with @cfunc" href="cfunc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Numba
          

          
            
            <img src="../_static/numba-blue-icon-rgb.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.49
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">1. User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="5minguide.html">1.1. A ~5 minute guide to Numba</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">1.2. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing.html">1.3. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="jit.html">1.4. Compiling Python code with <code class="docutils literal notranslate"><span class="pre">&#64;jit</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="generated-jit.html">1.5. Flexible specializations with <code class="docutils literal notranslate"><span class="pre">&#64;generated_jit</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="vectorize.html">1.6. Creating Numpy universal functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="jitclass.html">1.7. Compiling Python classes with <code class="docutils literal notranslate"><span class="pre">&#64;jitclass</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cfunc.html">1.8. Creating C callbacks with <code class="docutils literal notranslate"><span class="pre">&#64;cfunc</span></code></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">1.9. Compiling code ahead of time</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">1.9.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#benefits">1.9.1.1. Benefits</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitations">1.9.1.2. Limitations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#usage">1.9.2. Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#standalone-example">1.9.2.1. Standalone example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#distutils-integration">1.9.2.2. Distutils integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#signature-syntax">1.9.2.3. Signature syntax</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parallel.html">1.10. Automatic parallelization with <code class="docutils literal notranslate"><span class="pre">&#64;jit</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="stencil.html">1.11. Using the <code class="docutils literal notranslate"><span class="pre">&#64;stencil</span></code> decorator</a></li>
<li class="toctree-l2"><a class="reference internal" href="withobjmode.html">1.12. Callback into the Python Interpreter from within JIT’ed code</a></li>
<li class="toctree-l2"><a class="reference internal" href="jit-module.html">1.13. Automatic module jitting with <code class="docutils literal notranslate"><span class="pre">jit_module</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="performance-tips.html">1.14. Performance Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="threading-layer.html">1.15. The Threading Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html">1.16. Command line interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshoot.html">1.17. Troubleshooting and tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">1.18. Frequently Asked Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">1.19. Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="talks.html">1.20. Talks and Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">2. Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/index.html">3. Numba for CUDA GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda-reference/index.html">4. CUDA Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roc/index.html">5. Numba for AMD ROC GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">6. Extending Numba</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">7. Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proposals/index.html">8. Numba Enhancement Proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">10. Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Numba</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">1. User Manual</a> &raquo;</li>
        
      <li>1.9. Compiling code ahead of time</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user/pycc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="compiling-code-ahead-of-time">
<h1>1.9. Compiling code ahead of time<a class="headerlink" href="#compiling-code-ahead-of-time" title="Permalink to this headline">¶</a></h1>
<p id="pycc">While Numba’s main use case is <a class="reference internal" href="../glossary.html#term-just-in-time-compilation"><span class="xref std std-term">Just-in-Time compilation</span></a>, it also
provides a facility for <a class="reference internal" href="../glossary.html#term-ahead-of-time-compilation"><span class="xref std std-term">Ahead-of-Time compilation</span></a> (AOT).</p>
<div class="section" id="overview">
<h2>1.9.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="benefits">
<h3>1.9.1.1. Benefits<a class="headerlink" href="#benefits" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>AOT compilation produces a compiled extension module which does not depend
on Numba: you can distribute the module on machines which do not have
Numba installed (but Numpy is required).</p></li>
<li><p>There is no compilation overhead at runtime (but see the
<code class="docutils literal notranslate"><span class="pre">&#64;jit</span></code> <a class="reference internal" href="jit.html#jit-cache"><span class="std std-ref">cache</span></a> option), nor any overhead of importing
Numba.</p></li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Compiled extension modules are discussed in the
<a class="reference external" href="https://packaging.python.org/en/latest/extensions/">Python packaging user guide</a>.</p>
</div>
</div>
<div class="section" id="limitations">
<h3>1.9.1.2. Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>AOT compilation only allows for regular functions, not <a class="reference internal" href="../glossary.html#term-ufunc"><span class="xref std std-term">ufuncs</span></a>.</p></li>
<li><p>You have to specify function signatures explicitly.</p></li>
<li><p>Each exported function can have only one signature (but you can export
several different signatures under different names).</p></li>
<li><p>AOT compilation produces generic code for your CPU’s architectural family
(for example “x86-64”), while JIT compilation produces code optimized
for your particular CPU model.</p></li>
</ol>
</div>
</div>
<div class="section" id="usage">
<h2>1.9.2. Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="standalone-example">
<h3>1.9.2.1. Standalone example<a class="headerlink" href="#standalone-example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numba.pycc</span> <span class="kn">import</span> <span class="n">CC</span>

<span class="n">cc</span> <span class="o">=</span> <span class="n">CC</span><span class="p">(</span><span class="s1">&#39;my_module&#39;</span><span class="p">)</span>
<span class="c1"># Uncomment the following line to print out the compilation steps</span>
<span class="c1">#cc.verbose = True</span>

<span class="nd">@cc</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="s1">&#39;multf&#39;</span><span class="p">,</span> <span class="s1">&#39;f8(f8, f8)&#39;</span><span class="p">)</span>
<span class="nd">@cc</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="s1">&#39;multi&#39;</span><span class="p">,</span> <span class="s1">&#39;i4(i4, i4)&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mult</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="nd">@cc</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;f8(f8)&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cc</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
</pre></div>
</div>
<p>If you run this Python script, it will generate an extension module named
<code class="docutils literal notranslate"><span class="pre">my_module</span></code>.  Depending on your platform, the actual filename may be
<code class="docutils literal notranslate"><span class="pre">my_module.so</span></code>, <code class="docutils literal notranslate"><span class="pre">my_module.pyd</span></code>, <code class="docutils literal notranslate"><span class="pre">my_module.cpython-34m.so</span></code>, etc.</p>
<p>The generated module has three functions: <code class="docutils literal notranslate"><span class="pre">multf</span></code>, <code class="docutils literal notranslate"><span class="pre">multi</span></code> and <code class="docutils literal notranslate"><span class="pre">square</span></code>.
<code class="docutils literal notranslate"><span class="pre">multi</span></code> operates on 32-bit integers (<code class="docutils literal notranslate"><span class="pre">i4</span></code>), while <code class="docutils literal notranslate"><span class="pre">multf</span></code> and <code class="docutils literal notranslate"><span class="pre">square</span></code>
operate on double-precision floats (<code class="docutils literal notranslate"><span class="pre">f8</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">my_module</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_module</span><span class="o">.</span><span class="n">multi</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">12</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_module</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mf">1.414</span><span class="p">)</span>
<span class="go">1.9993959999999997</span>
</pre></div>
</div>
</div>
<div class="section" id="distutils-integration">
<h3>1.9.2.2. Distutils integration<a class="headerlink" href="#distutils-integration" title="Permalink to this headline">¶</a></h3>
<p>You can also integrate the compilation step for your extension modules
in your <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> script, using distutils or setuptools:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="kn">from</span> <span class="nn">source_module</span> <span class="kn">import</span> <span class="n">cc</span>

<span class="n">setup</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
      <span class="n">ext_modules</span><span class="o">=</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">distutils_extension</span><span class="p">()])</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">source_module</span></code> above is the module defining the <code class="docutils literal notranslate"><span class="pre">cc</span></code> object.
Extensions compiled like this will be automatically included in the
build files for your Python project, so you can distribute them inside
binary packages such as wheels or Conda packages. Note that in the case of
using conda, the compilers used for AOT need to be those that are available
in the Anaconda distribution.</p>
</div>
<div class="section" id="signature-syntax">
<h3>1.9.2.3. Signature syntax<a class="headerlink" href="#signature-syntax" title="Permalink to this headline">¶</a></h3>
<p>The syntax for exported signatures is the same as in the <code class="docutils literal notranslate"><span class="pre">&#64;jit</span></code>
decorator.  You can read more about it in the <a class="reference internal" href="../reference/types.html#numba-types"><span class="std std-ref">types</span></a>
reference.</p>
<p>Here is an example of exporting an implementation of the second-order
centered difference on a 1d array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@cc</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="s1">&#39;centdiff_1d&#39;</span><span class="p">,</span> <span class="s1">&#39;f8[:](f8[:], f8)&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">centdiff_1d</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">D</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">D</span>
</pre></div>
</div>
<p>You can also omit the return type, which will then be inferred by Numba:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@cc</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="s1">&#39;centdiff_1d&#39;</span><span class="p">,</span> <span class="s1">&#39;(f8[:], f8)&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">centdiff_1d</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
    <span class="c1"># Same code as above</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parallel.html" class="btn btn-neutral float-right" title="1.10. Automatic parallelization with @jit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cfunc.html" class="btn btn-neutral float-left" title="1.8. Creating C callbacks with @cfunc" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2020, Anaconda, Inc. and others

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>